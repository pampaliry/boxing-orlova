import{_ as ie}from"./BmRp3P0A.js";import{a1 as ue,a5 as me,v as p,S as fe,a6 as de,e as H,o as C,w as l,b as i,a as s,c as pe,a4 as _e,d as T,t as W,_ as L}from"#entry";import{u as ve}from"./CQseFoOa.js";import{c as z,b as X,V as q}from"./DeKbPWVI.js";import{V as F}from"./DNrZhH3K.js";import"./B5e48uHx.js";const he={class:"text-medium-emphasis","aria-live":"polite"},be={key:0},ge={class:"d-flex align-center mb-4"},Se={class:"chart-wrap",role:"img","aria-label":"Historický priebeh BPM z WebSocketu"},ke="wss://stream.binance.com:9443/ws/btcusdt@trade",v=40,x=140,ye=3,xe=12,A=800,_=180,Me=56,M=10,Te=3e4,we=ue({__name:"WebSocketBpm",setup(J){ve({title:"WS BPM – Live WebSocket demo",meta:[{name:"description",content:"Živý WebSocket graf s BPM hodnotou odvodenou z reálnych dát."}]});const u=me(),w=typeof u.public?.wsUrl=="string"?u.public.wsUrl.trim():"",d=p(w||ke),r=p("disconnected"),m=p(72),E=p(72),h=A-Me,Y=[60,80,100,120],I=p(null);let t;const f=[],V=h,$=p(40);let b=0,g=0,P=0;function G(){return 1/Math.max(20,$.value)}let c=null,S=null,k=0;function K(){const e=Math.min(Te,1e3*2**k);return k=Math.min(k+1,10),e}function Z(){const e=K();r.value="connecting",S=setTimeout(R,e)}function Q(e){try{return JSON.parse(e)}catch{return null}}function ee(e,n){if(typeof e=="object"&&e!==null){const o=e[n];if(typeof o=="number")return o;if(typeof o=="string"){const a=Number(o);if(!Number.isNaN(a))return a}}return null}function te(e){const n=["t","p","q","E","T"];for(const o of n){const a=ee(e,o);if(a!==null)return a}return null}function ne(e){if(!Number.isFinite(e))return 72;const n=61,o=55,a=Math.abs(Math.floor(e))%n;return o+a}function y(e,n,o){return Math.min(o,Math.max(n,e))}function R(){if(d.value){r.value="connecting";try{c=new WebSocket(d.value),c.onopen=()=>{r.value="connected",k=0},c.onmessage=e=>{const n=typeof e.data=="string"?e.data:"",o=Q(n);if(!o)return;const a=te(o);if(a==null)return;const B=y(ne(a),v+5,x-5);E.value=B},c.onerror=()=>{r.value="error"},c.onclose=()=>{r.value="disconnected",U(),Z()}}catch{r.value="error"}}}function U(){if(S&&(clearTimeout(S),S=null),c){try{c.close()}catch{}c=null}}function N(e){const n=y(e,v,x),o=_-2*M;return M+(1-(n-v)/(x-v))*o}function oe(){t.strokeStyle="#e5e7eb",t.lineWidth=1;for(let e=0;e<h;e+=40)t.beginPath(),t.moveTo(e+.5,0),t.lineTo(e+.5,_),t.stroke();for(let e=0;e<_;e+=40)t.beginPath(),t.moveTo(0,e+.5),t.lineTo(h,e+.5),t.stroke()}function ae(){const e=h+.5;t.strokeStyle="#9ca3af",t.lineWidth=1,t.beginPath(),t.moveTo(e,M),t.lineTo(e,_-M),t.stroke(),t.fillStyle="#374151",t.font="12px system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, sans-serif",t.textAlign="left",t.textBaseline="middle",Y.forEach(o=>{const a=N(o);t.strokeStyle="#d1d5db",t.beginPath(),t.moveTo(e,a),t.lineTo(e+8,a),t.stroke(),t.fillText(String(o),e+12,a)});const n=N(m.value);t.fillStyle="#16a34a",t.beginPath(),t.arc(e+10,n,4,0,Math.PI*2),t.fill()}function re(){if(!(f.length<2)){t.strokeStyle="#16a34a",t.lineWidth=2,t.beginPath();for(let e=0;e<f.length;e++){const n=e,o=N(f[e]);e===0?t.moveTo(n,o):t.lineTo(n,o)}t.stroke()}}function se(){t.clearRect(0,0,A,_),oe(),re(),ae()}function O(e){const n=e||performance.now();g||(g=n);const o=Math.min(.05,(n-g)/1e3);g=n;const a=Math.min(1,ye*o),B=(E.value-m.value)*a,D=xe*o,ce=y(B,-D,D);m.value=y(m.value+ce,v,x),P+=o;const j=G();for(;P>=j;)f.length>=V&&f.shift(),f.push(m.value),P-=j;se(),b=requestAnimationFrame(O)}fe(()=>{const e=I.value;if(!e)return;const n=e.getContext("2d");if(n){t=n;for(let o=0;o<V;o++)f.push(m.value);b=requestAnimationFrame(O),d.value&&R()}}),de(()=>{b&&cancelAnimationFrame(b),U()});function le(e,n=36,o=18){return e.length<=n+o+1?e:`${e.slice(0,n)}…${e.slice(-o)}`}return(e,n)=>(C(),H(z,{color:"",class:"pa-6",elevation:"8",role:"region","aria-label":"Live WebSocket BPM"},{default:l(()=>[i(X,{class:"d-flex align-center justify-space-between flex-wrap"},{default:l(()=>[n[1]||(n[1]=s("span",{class:"text-h5"},"WebSocket BPM (minimal)",-1)),s("div",he,[i(F,{color:r.value==="connected"?"green":r.value==="connecting"?"orange":r.value==="error"?"red":"grey",size:"small",class:"mr-2"},{default:l(()=>[T(W(r.value),1)]),_:1},8,["color"]),r.value!=="disconnected"?(C(),pe("span",be,[s("small",null,[n[0]||(n[0]=T("WS: ",-1)),s("code",null,W(le(d.value)),1)])])):_e("",!0)])]),_:1}),i(q,null,{default:l(()=>[s("div",ge,[n[2]||(n[2]=s("strong",null,"BPM:",-1)),i(F,{size:"small",color:"primary",class:"ml-2"},{default:l(()=>[T(W(Math.round(m.value)),1)]),_:1})]),s("div",Se,[s("canvas",{ref_key:"canvasRef",ref:I,class:"chart",width:A,height:_},null,512)])]),_:1})]),_:1}))}}),Pe=L(we,[["__scopeId","data-v-10420312"]]),Ne={};function Be(J,u){const w=ie,d=Pe;return C(),H(z,{class:"pa-8",elevation:"10","aria-label":"Zoznam projektov"},{default:l(()=>[i(X,null,{default:l(()=>[...u[0]||(u[0]=[s("h1",{class:"text-center"}," Moje Projekty ",-1)])]),_:1}),i(q,{class:""},{default:l(()=>[i(w,{href:"http://www.umy-ma.sk",target:"_blank",rel:"noopener noreferrer","aria-label":"Otvoriť projekt umy-ma.sk v novom okne"},{default:l(()=>[...u[1]||(u[1]=[T(" umy-ma.sk ",-1)])]),_:1})]),_:1}),i(d)]),_:1})}const Re=L(Ne,[["render",Be]]);export{Re as default};
